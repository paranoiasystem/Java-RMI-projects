package com.marcoferraioli.client;

import java.rmi.Naming;
import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;
import java.util.logging.Logger;

import com.marcoferraioli.server.ServerImpl;

public class ClientImpl extends UnicastRemoteObject implements Client{
	
	private static final long serialVersionUID = 1L;
	static Logger logger = Logger.getLogger("global");
	
	static String username;
	ServerImpl server;

	protected ClientImpl(String username) throws RemoteException {
		super();
		ClientImpl.username = username;
		try {
			server = (ServerImpl) Naming.lookup("rmi://localhost/chat");
			server.iscrivi(this, ClientImpl.username);
			
		} catch(Exception e) {
			logger.severe("Non trovo il server o non riesco ad iscrivermi.");
			e.printStackTrace();
			System.exit(1);
		}
	}

	@Override
	public void detto(String username, String message) throws RemoteException {
		if(!ClientImpl.username.equals(username))
			System.out.print(username + ": " + message + "\n >> ");
	}

	@Override
	public void iscritto(String username) throws RemoteException {
		System.out.print(username + "entra nel server\n >> ");
	}

	@Override
	public void abbandonato(String username) throws RemoteException {
		System.out.print(username + "abbandona il server\n >> ");
	}

}
